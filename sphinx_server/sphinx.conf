#
# Minimal Sphinx configuration sample (clean, simple, functional)
#

index rt_adverts
{
	type			= rt
	path			= /home/baraholk/sphinx/data/rt_adverts/rt_adverts
	rt_mem_limit	= 128M

    rt_attr_uint    = active_tag
    rt_attr_uint    = verify_tag

    rt_attr_string = title
    rt_attr_string = notice_text
    rt_attr_string = props_xml
    rt_attr_string = props_for_index
    rt_attr_string = rubrik
    rt_attr_string = town
    rt_attr_string = region
    rt_attr_string = country

    rt_field = title
    rt_field = notice_text
    rt_field = props_xml
    rt_field = props_for_index
    rt_field = rubrik
    rt_field = town
    rt_field = region
    rt_field = country

    ##########################################

    docinfo	    	= extern
    dict			= keywords
    #mlock			= 0

    morphology      = lemmatize_ru_all, stem_enru
    #morphology		= stem_enru

    min_infix_len   = 3
    #min_prefix_len = 2

    expand_keywords     = 1
    index_exact_words   = 1

    #min_stemming_len	= 1

    #stopwords		= /home/baraholk/sphinx/dicts/stopwords.txt
    wordforms		= /home/baraholk/sphinx/dicts/wordforms.txt

    min_word_len		= 1

    charset_table   = 0..9, A..Z->a..z, _, a..z, \
            U+410..U+42F->U+430..U+44F, U+430..U+44F, U+401->U+0435, U+451->U+0435

    blend_chars		= +, &, U+23

    html_strip		= 1


}

index rt_search_stat
{
	type			= rt
	path			= /home/baraholk/sphinx/data/rt_search_stat/rt_search_stat
	rt_mem_limit	= 128M

    rt_attr_string = query
    rt_attr_string = count

    rt_field = query

    ##########################################

    docinfo	    	= extern
    dict			= keywords
    #mlock			= 0

    morphology      = lemmatize_ru_all, stem_enru
    #morphology		= stem_enru

    min_infix_len   = 3
    #min_prefix_len = 2

    expand_keywords     = 1
    index_exact_words   = 1

    #min_stemming_len	= 1

    #stopwords		= /home/baraholk/sphinx/dicts/stopwords.txt
    wordforms		= /home/baraholk/sphinx/dicts/wordforms.txt

    min_word_len		= 1

    charset_table   = 0..9, A..Z->a..z, _, a..z, \
            U+410..U+42F->U+430..U+44F, U+430..U+44F, U+401->U+0435, U+451->U+0435

    blend_chars		= +, &, U+23

    html_strip		= 1


}


#############################################################################
## indexer settings
#############################################################################

indexer
{
	# memory limit, in bytes, kiloytes (16384K) or megabytes (256M)
	# optional, default is 128M, max is 2047M, recommended is 256M to 1024M
	mem_limit		= 256M

	# maximum IO calls per second (for I/O throttling)
	# optional, default is 0 (unlimited)
	#
	# max_iops		= 40


	# maximum IO call size, bytes (for I/O throttling)
	# optional, default is 0 (unlimited)
	#
	# max_iosize		= 1048576


	# maximum xmlpipe2 field length, bytes
	# optional, default is 2M
	#
	# max_xmlpipe2_field	= 4M


	# write buffer size, bytes
	# several (currently up to 4) buffers will be allocated
	# write buffers are allocated in addition to mem_limit
	# optional, default is 1M
	#
	# write_buffer		= 1M


	# maximum file field adaptive buffer size
	# optional, default is 8M, minimum is 1M
	#
	# max_file_field_buffer	= 32M


	# how to handle IO errors in file fields
	# known values are 'ignore_field', 'skip_document', and 'fail_index'
	# optional, default is 'ignore_field'
	#
	# on_file_field_error = skip_document


	# lemmatizer cache size
	# improves the indexing time when the lemmatization is enabled
	# optional, default is 256K
	#
	lemmatizer_cache = 128M
}


searchd
{
	#listen			= 9312
	listen			= 9306:mysql41
	log			    = /var/log/sphinx/searchd.log
	query_log		= /var/log/sphinx/query.log
	client_timeout	= 300
	read_timeout	= 5
	max_children	= 30
	pid_file		= /var/run/sphinx/searchd.pid
	seamless_rotate	= 1
	preopen_indexes	= 1
	unlink_old		= 1
	attr_flush_period	= 900
	workers			= threads # for RT to work
	binlog_path		= /var/lib/sphinx/
}


common
{

	# lemmatizer dictionaries base path
	# optional, defaut is /usr/local/share (see ./configure --datadir)
	#
	lemmatizer_base = /home/baraholk/sphinx/dicts/


	# how to handle syntax errors in JSON attributes
	# known values are 'ignore_attr' and 'fail_index'
	# optional, default is 'ignore_attr'
	#
	# on_json_attr_error = fail_index


	# whether to auto-convert numeric values from strings in JSON attributes
	# with auto-conversion, string value with actually numeric data
	# (as in {"key":"12345"}) gets stored as a number, rather than string
	# optional, allowed values are 0 and 1, default is 0 (do not convert)
	#
	# json_autoconv_numbers = 1


	# whether and how to auto-convert key names in JSON attributes
	# known value is 'lowercase'
	# optional, default is unspecified (do nothing)
	#
	# json_autoconv_keynames = lowercase


	# path to RLP root directory
	# optional, defaut is /usr/local/share (see ./configure --datadir)
	#
	# rlp_root = /usr/local/share/sphinx/rlp


	# path to RLP environment file
	# optional, defaut is /usr/local/share/rlp-environment.xml (see ./configure --datadir)
	#
	# rlp_environment = /usr/local/share/sphinx/rlp/rlp/etc/rlp-environment.xml


	# maximum total size of documents batched before processing them by the RLP
	# optional, default is 51200
	#
	# rlp_max_batch_size = 100k


	# maximum number of documents batched before processing them by the RLP
	# optional, default is 50
	#
	# rlp_max_batch_docs = 100


	# trusted plugin directory
	# optional, default is empty (disable UDFs)
	#
	# plugin_dir			= /usr/local/sphinx/lib

}
